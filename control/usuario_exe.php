<?phpfunction consultaUsuario($data, $client){	require ("lib/bd.php");		$id = $data->id;	$cpf = $data->user;	$senha = $data->password;		echo "CLIENTE:" . $client . "\n";	$sql = "";	$consulta;	if(is_null($id)){		echo "Verificando login e senha\n";		$sql = "SELECT * FROM usuario WHERE cpf = ? and senha = ? and cliente = ?"; //FAZER CORREO PARA MAIS CLIENTES		$consulta = $bd->prepare($sql);		$consulta->bindParam(1, $cpf);		$consulta->bindParam(2, $senha);		$consulta->bindParam(3, $client);	}else{		echo "Verificando informacoes do token\n";		$sql = "SELECT * FROM usuario WHERE id = ? and cliente = ?"; //FAZER CORREO PARA MAIS CLIENTES		$consulta = $bd->prepare($sql);		$consulta->bindParam(1, $id);		$consulta->bindParam(2, $client);	}		$consulta->execute();		$usuarios;	while($row = $consulta->fetch(PDO::FETCH_OBJ)){		$usuarios = array("id" => $row->id, "client" => $row->cliente,"name" => $row->nome, "cpf"=>$row->cpf, "email"=>$row->email, "phone"=>$row->telefone);		echo $row->id . " - " . $row->cliente . " - " . $row->nome . " - " . $row->cpf . " - " . $row->email . " - " . $row->telefone . "\n";		    }		if (is_array($usuarios)) {	    return $usuarios;	} else {		echo "Nenhum registro encontrado\n";		return false;	}			}function cadastraUsuario($data, $client){	require ("lib/bd.php");		$cliente = $client;	$nome = $data->name;	$cpf = $data->cpf;	$email = $data->email;	$telefone = $data->phone;	$senha = $data->password;	$chave = mt_rand(1000,9999);		echo "Inserindo registro usuario:\n";	$sql = "INSERT INTO usuario (cliente, nome, cpf, senha, email, telefone, chave, ativo) VALUES (?, ?, ?, ?, ?, ?, ?, ?)"; //FAZER CORREO PARA MAIS CLIENTES	$consulta = $bd->prepare($sql);	$consulta->bindValue(1, $cliente);	$consulta->bindValue(2, $nome);	$consulta->bindValue(3, $cpf);	$consulta->bindValue(4, $senha);	$consulta->bindValue(5, $email);	$consulta->bindValue(6, $telefone);	$consulta->bindValue(7, $chave);	$consulta->bindValue(8, false);	$consulta->execute();	if($consulta){		if(envia_email("Sistema de confirmao", $email, "Cdigo de confirmao de cadastro", "Seja bem vindo " . $nome . "\n\n" . "Este  seu cdigo de verificao: " . $chave)){			echo "E-mail de confirmacao enviado com sucesso\n";			return $bd->lastInsertId();		}else{			return "-1";		}	}else{		return "0";		//return "failed"; //NA VERIFICAO SE OS DADOS VIERAM CORRETOS, CASO NO TENHAM VINDO DEVE-SE RETORNAR ERROR, POR ISSO NO  TRUE E FALSE	}			}function validaUsuario($data, $client, $user){ //FAZER CDIGO QUE VERIFIQUE SE OS DADOS VIERAM CORRETOS	require ("lib/bd.php");	$chave = $data->cod;	echo "Validando usuario: $id\n";	$sql = "UPDATE usuario SET ativo = 1 WHERE chave = ? and id = ?"; //FAZER CORREO PARA MAIS CLIENTES	$consulta = $bd->prepare($sql);	$consulta->bindParam(1, $chave);	$consulta->bindParam(2, $user);	$consulta->execute();	if($consulta->rowCount()){		return "success"; //NA VERIFICAO SE OS DADOS VIERAM CORRETOS, CASO NO TENHAM VINDO DEVE-SE RETORNAR ERROR, POR ISSO NO  TRUE E FALSE	}else{		return "failed";	}}// FUNES ESQUECI A SENHAfunction consultaUsuarioEmail($data, $client){	require ("lib/bd.php");	$email = $data->email;	echo "Verificando usuario pelo email\n";	$sql = "SELECT * FROM usuario WHERE email = ? and cliente = ?"; //FAZER CORREO PARA MAIS CLIENTES	$consulta = $bd->prepare($sql);	$consulta->bindParam(1, $email);	$consulta->bindParam(2, $client);		$consulta->execute();	$usuarios;	while($row = $consulta->fetch(PDO::FETCH_OBJ)){		$usuarios = array("id" => $row->id, "client" => $row->cliente,"name" => $row->nome, "cpf"=>$row->cpf, "email"=>$row->email, "phone"=>$row->telefone);		echo $row->id . " - " . $row->cliente . " - " . $row->nome . " - " . $row->cpf . " - " . $row->email . " - " . $row->telefone . "\n";	}	if (is_array($usuarios)) {		return $usuarios;	} else {		echo "Nenhum registro encontrado\n";		return false;	}			}function gerarNovaChave($client, $user){ //FAZER CDIGO QUE VERIFIQUE SE OS DADOS VIERAM CORRETOS	require ("lib/bd.php");	$chave = mt_rand(1000,9999);	$dados = consultaUsuario(array("id"=>$user), $client);	$email = $dados["email"];	echo "Gerando nova chave de usuario\n";	$sql = "UPDATE usuario SET chave = ? WHERE cliente = ? and id = ?"; //FAZER CORREO PARA MAIS CLIENTES	$consulta = $bd->prepare($sql);	$consulta->bindParam(1, $chave);	$consulta->bindParam(2, $client);	$consulta->bindParam(3, $user);	$consulta->execute();	if($consulta->rowCount()){		if(envia_email("Recuperao de senha", $email, "Cdigo de recuperao de senha", "Ol " . $nome . "\n\n" . "Voc solicitou a recuperao de sua senha em " . date('H:i:s d-m-Y') . "\n" . "Este  seu cdigo: " . $chave . "\n" . "Informe ele no aplicativo para poder cadastrar uma nova senha.")){			return "success"; //NA VERIFICAO SE OS DADOS VIERAM CORRETOS, CASO NO TENHAM VINDO DEVE-SE RETORNAR ERROR, POR ISSO NO  TRUE E FALSE		}else{			return "failed";		}	}else{		return "failed";	}}function gravarSenha($data, $client){ //FAZER CDIGO QUE VERIFIQUE SE OS DADOS VIERAM CORRETOS	require ("lib/bd.php");	$email = $data->email;	$senha = $data->password;	$chave = $data->cod;	echo "Gravando nova senha de usuario\n";	$sql = "UPDATE usuario SET senha = ? WHERE cliente = ? and email = ? and chave = ?"; //FAZER CORREO PARA MAIS CLIENTES	$consulta = $bd->prepare($sql);	$consulta->bindParam(1, $senha);	$consulta->bindParam(2, $client);	$consulta->bindParam(3, $email);	$consulta->bindParam(4, $chave);	$consulta->execute();	if($consulta->rowCount()){		return "success"; //NA VERIFICAO SE OS DADOS VIERAM CORRETOS, CASO NO TENHAM VINDO DEVE-SE RETORNAR ERROR, POR ISSO NO  TRUE E FALSE	}else{		return "failed";	}}?>